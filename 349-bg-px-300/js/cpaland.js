!function(e){"object"==typeof exports&&"undefined"!=typeof module||"function"!=typeof define||!define.amd?e():define("cpaland",e)}((function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function a(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}(e))){var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,i=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw o}}}}var r={domReady:function(e){var t;document.addEventListener?document.addEventListener("DOMContentLoaded",e):t=setInterval((function(){"complete"===document.readyState&&(clearInterval(t),e())}),5)},on:function(e,t,n,a){e.addEventListener?e.addEventListener(t,(function(e){n.call(a,e)}),!1):e.attachEvent&&e.attachEvent("on".concat(t),(function(e){n.call(a,e)}))},each:function(e,t){e.forEach((function(e,n){return t(e,n)}))},extend:function(e,t){var n={};return Object.keys(e).forEach((function(t){return n[t]=e[t]})),Object.keys(t).forEach((function(e){return n[e]=t[e]})),n},serialize:function(e){var t,n={},r=a(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;n[o.getAttribute("name")]=o.value}}catch(e){r.e(e)}finally{r.f()}return n},urlGET:function(e){return null===(e=new RegExp("[?&]".concat(encodeURIComponent(e),"=([^&]*)")).exec(location.search))?"":decodeURIComponent(e[1])},objectToGet:function(e){var t="";return Object.keys(e).forEach((function(n){return t+="&".concat(n,"=").concat(encodeURIComponent(e[n]))})),t},JSONP:function(e){var t=document.createElement("script");t.async=!0,t.setAttribute("src",e),document.body.appendChild(t)},isPhone:function(e){return 7<e.length},isName:function(e){return 2<e.length},isEmail:function(e){return/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(e)}},o={YA:function(e){return"(function(d, w, c) {\n    (w[c] = w[c] || []).push(function() {\n      try {\n        w.yaCounter".concat(e," = new Ya.Metrika({\n          id: ").concat(e,', \n          webvisor: true, \n          clickmap: true, \n          trackLinks: true, \n          accurateTrackBounce: true, \n          ut: "noindex"\n        }); \n      } catch (e) {} });\n      \n      var n = d.getElementsByTagName("script")[0],\n          s = d.createElement("script"),\n          f = function() {n.parentNode.insertBefore(s, n); };\n          s.type = "text/javascript"; s.async = true;\n          s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";\n          \n          if (w.opera == "[object Opera]") { \n            d.addEventListener("DOMContentLoaded", f, false); \n          } else { \n            f();\n          }\n  })(document, window, "yandex_metrika_callbacks");')},GA:function(e){return"(function(i,s,o,g,r,a,m){\n    i['GoogleAnalyticsObject'] = r;\n    i[r] = i[r] || function(){\n      (i[r].q = i[r].q || []).push(arguments)\n    },\n    i[r].l = 1 * new Date();\n    a = s.createElement(o), \n    m = s.getElementsByTagName(o)[0];\n    a.async = 1;\n    a.src = g;\n    m.parentNode.insertBefore(a,m)\n  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\n  \n  ga('create', '".concat(e,"', 'auto');\n  ga('send', 'pageview');")},FB:function(e){return"!function(f,b,e,v,n,t,s){\n    if(f.fbq) return;\n    \n    n = f.fbq = function(){\n      n.callMethod ? n.callMethod.apply(n,arguments) : n.queue.push(arguments)\n    };\n    \n    if(!f._fbq) f._fbq = n;\n    \n    n.push = n;\n    n.loaded = !0;\n    n.version = '2.0';\n    n.queue = [];\n    t = b.createElement(e);\n    t.async = !0;\n    t.src = v;\n    s = b.getElementsByTagName(e)[0];\n    s.parentNode.insertBefore(t,s)\n  }(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');\n  \n  fbq('init', '".concat(e,"');\n  fbq('track', 'PageView');\n  \n  if(/success/g.test(window.location.pathname)) {\n   fbq('track','Lead');\n  }")},TK:function(e){return"(function() {\n    var ta = document.createElement('script'); ta.type = 'text/javascript'; ta.async = true;\n    ta.src = 'https://analytics.tiktok.com/i18n/pixel/sdk.js?sdkid=".concat(e,"';\n    var s = document.getElementsByTagName('script')[0];\n    s.parentNode.insertBefore(ta, s);\n  })();")}};window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),window.lq=r;var i=function(){function n(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.params=r.extend({hasLocalStorage:"undefined"!=typeof Storage,location:document.location.hostname+document.location.pathname,tid:r.urlGET("tid")},e),this.counters=o,r.domReady(this.initDOM.bind(this)),this}var i,c;return i=n,(c=[{key:"initDOM",value:function(){this.initialize(),this.initEvents(),this.checkTest(),"object"===e(window.lCountries)&&(window.lCountries.initEvents(),window.lCountries.setActiveCountrySelect())}},{key:"initialize",value:function(){var e=r.objectToGet({jsoncallback:"CpaLand.initLandData",url:window.location.href});r.JSONP("/js/index?".concat(e))}},{key:"initEvents",value:function(){var e,t=this,n=document.querySelectorAll(".cpa__order_form"),r=document.querySelectorAll(".x_subscribe_form"),o=a(n);try{for(o.s();!(e=o.n()).done;)e.value.onsubmit=function(e){return t.submitOrderForm.call(t,e)}}catch(e){o.e(e)}finally{o.f()}var i,c=a(r);try{for(c.s();!(i=c.n()).done;)i.value.onsubmit=function(e){return t.submitEmailForm(e)}}catch(e){c.e(e)}finally{c.f()}}},{key:"initLandData",value:function(e){var t;this.params=r.extend(this.params,e),"layer"===this.params.type&&(t=this.params.landing.url||"",!0===this.params.comebacker.isActive&&(this.params.comebacker.text=this.params.comebacker.text.split("/n ").join("\n"),this.initComeBacker(this.params.comebacker)),r.each(document.querySelectorAll("a"),(function(e){e.setAttribute("target","_blank"),e.setAttribute("href",t)}))),e.counters.yaMetrika.length&&this.addMetric("YA",e.counters.yaMetrika),e.counters.googleAnalytics.length&&this.addMetric("GA",e.counters.googleAnalytics),e.counters.tikTok.length&&this.addMetric("TK",e.counters.tikTok),e.counters.vk.length&&this.addVkMetric(e.counters.vk),void 0!==e.counters.facebook&&e.counters.facebook.length&&this.addMetric("FB",e.counters.facebook),e.hasOwnProperty("conversion")&&(this.appendingCss=!1,e.conversion.customers&&this.showSideNotify(),e.conversion.delivery&&this.showDeliveryJaw(),e.conversion.freezePrice&&this.showFreezer(),e.conversion.freezePrice&&this.showOnlineHeader(),e.conversion.onlineSide&&this.showCustomersJaw()),this.setFormAction()}},{key:"addMetric",value:function(e,t){var n;"function"==typeof this.counters[e]&&((n=document.createElement("script")).innerHTML=this.counters[e](t),document.body.appendChild(n))}},{key:"addVkMetric",value:function(e){var t=document.createElement("div");t.innerHTML=e,document.body.appendChild(t)}},{key:"setFormAction",value:function(){var e,t,n,r,o=a(document.querySelectorAll(".cpa__order_form"));try{for(o.s();!(e=o.n()).done;){var i=e.value;i.setAttribute("action","/lead/add"),i.setAttribute("method","POST"),t=i,"tid",n=this.params.tid,r=void 0,(r=document.createElement("input")).setAttribute("type","hidden"),r.setAttribute("name","tid"),r.value=n,t.appendChild(r)}}catch(e){o.e(e)}finally{o.f()}}},{key:"initComeBacker",value:function(e){var t=this,n=document.createElement("script");n.src="/iclick/js/comebacker.js",n.onload=function(){return t.ComeBacker=new ComeBacker(e)},document.querySelector("head").appendChild(n)}},{key:"submitOrderForm",value:function(e){var t,n=(e=e||window.event).currentTarget||e.srcElement,o=lCountries.countries[lCountries.userCountryCode],i=a(n);try{for(i.s();!(t=i.n()).done;){var c=t.value,s=c.getAttribute("name");if("phone"===s&&!r.isPhone(c.value))return e.preventDefault?e.preventDefault():e.returnValue=!1,alert(o.phoneError),!1;if("name"===s&&!r.isName(c.value))return e.preventDefault?e.preventDefault():e.returnValue=!1,alert(o.nameError),!1;if("email"===s&&0==!r.isEmail(c.value))return e.preventDefault?e.preventDefault():e.returnValue=!1,alert(o.emailError),!1;"submit"===c.getAttribute("type")&&c.setAttribute("disabled","disabled")}}catch(e){i.e(e)}finally{i.f()}return!0}},{key:"submitEmailForm",value:function(e){(e=e||window.event).preventDefault?e.preventDefault():e.returnValue=!1;var t=e.currentTarget,n=t.email.value,a="email=".concat(encodeURIComponent(n));this.params&&this.params.track&&(a+="&tid=".concat(this.params.track));var r=new XMLHttpRequest;r.open("POST",t.action,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){4==r.readyState&&t.parentElement.removeChild(t)},r.send(a)}},{key:"checkTest",value:function(){setTimeout((function(){var e;"#testcpa"===window.location.hash&&((e=document.createElement("script")).setAttribute("src","/iclick/js/cpa_test.js"),document.body.appendChild(e))}),3e3)}},{key:"showOnlineHeader",value:function(){var e=Math.round(1100*Math.random()+1800),t=Math.round(139*Math.random()+51),n=Math.round(80*Math.random()+70),a=document.createElement("div");a.classList.add("cpa__topline"),a.innerHTML='<span class="cpa__topline_item">Посетителей сегодня:'.concat(e,'</span>\n        <span class="cpa__topline_item">Сейчас на сайте:').concat(t,'</span>\n        <span class="cpa__topline_item">Заказов сегодня:').concat(n,"</span>"),this.appendingCss?document.body.appendChild(a):this.appendCss(a)}},{key:"appendCss",value:function(e,t){var n=document.querySelector("head"),a=document.createElement("link");a.href="/iclick/jaws/css/cpa-magick.min.css",a.type="text/css",a.rel="stylesheet",this.appendingCss=!0,n.appendChild(a),a.onload=function(){document.body.appendChild(e),"function"==typeof t&&t()}}},{key:"showSideNotify",value:function(){var e=this,t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","/iclick/js/lastpacknotify.js"),this.appendingCss?document.body.appendChild(t):this.appendCss(t),t.onload=function(){e.packNotify=new LastPackNotify({city:e.params.geo.city})}}},{key:"showDeliveryJaw",value:function(){var e=document.createElement("div");e.classList.add("cpa__delivery");var t="";function n(){var e=document.querySelector(".cpa__delivery_close");e.addEventListener("click",(function t(){document.querySelector(".cpa__delivery").classList.add("hidden"),e.removeEventListener("click",t)}))}this.params.geo.city&&(t=" в г."+this.params.geo.city),e.innerHTML='<div class="cpa__delivery_close"></div><div class="cpa__delivery_icon"></div><div class="cpa__delivery_text">Действует быстрая доставка'.concat(t,"</div>"),this.appendingCss?(document.body.appendChild(e),n()):this.appendCss(e,n)}},{key:"showCustomersJaw",value:function(){var e=document.createElement("div"),t=Math.round(160*Math.random()+40);function n(){var e=document.querySelector(".cpa__customers_close");e.addEventListener("click",(function t(){document.querySelector(".cpa__customers").classList.add("hidden"),e.removeEventListener("click",t)}))}e.classList.add("cpa__customers"),e.innerHTML='<div class="cpa__customers_close"></div><div class="cpa__customers_icon"><span class="icon-userscpa"></span></div><div class="cpa__customers_text">Сейчас '.concat(t," пользователей просматривают эту страницу вместе с вами.</div>"),this.appendingCss?(document.body.appendChild(e),n()):this.appendCss(e,n)}},{key:"showFreezer",value:function(){var e=Math.floor(111*Math.random())+40,t=document.createElement("div");t.classList.add("cpafreezing-wrap"),t.innerHTML='<div class="cpafreezing-info">\n        <div class="cpafreezing-info--title">Мы заморозили цену!</div>\n        <div class="cpafreezing-info--price">1$ = <span>45 руб.</span></div>\n        <div class="cpafreezing-info--packages">Осталось <span class="cpapackages-count">'.concat(e,'</span> шт. <br>по старому курсу</div>\n        <a href="#close" class="cpafreezing-close"></a></div>'),this.appendingCss?document.body.appendChild(t):this.appendCss(t),setTimeout((function(){t.classList.add("cpafreezing-active"),document.querySelector("html").classList.add("freezer")}),2e3),setTimeout((function(){t.classList.remove("cpafreezing-active"),document.querySelector("html").classList.remove("freezer")}),3e4),t.querySelector(".cpafreezing-close").onclick=function(e){e.preventDefault(),t.classList.add("cpafreezing-hide"),document.querySelector("html").classList.remove("freezer")}}}])&&t(i.prototype,c),n}();window.CpaLand=new i({})}));